<!DOCTYPE html>
<html><head>
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <title>Saxon-JS HTTP request termination</title>
        <meta name="robots" content="noindex, nofollow">
        <meta name="viewport" content="width=768, minimum-scale=1.0, maximum-scale=1.0">
        <script type="text/javascript" src="Saxon-JS%20HTTP%20request%20termination_files/jstree.js"></script>
        <script src="Saxon-JS%20HTTP%20request%20termination_files/SaxonJS.js"></script>
        <script>
      window.onload = function() {
        SaxonJS.transform({
           stylesheetLocation: "xsl/jstree.sef.xml",
           initialTemplate: "main"
           });
      }     
        </script>
        <link href="Saxon-JS%20HTTP%20request%20termination_files/jstree.css" rel="stylesheet" type="text/css">
            
    </head>

<body>

    <div id="wrap">
        
        <div id="header" class="unselectable">
            
            <!-- bread-crumb trail -->
            
            <ul class="trail" id="trail"><li id="trail1"><a href="http://saxonica.com/">Saxonica ▷</a></li><li id="trail2"><a href="http://www.saxonica.com/saxon-js/index.xml">Saxon-JS ▷</a></li><li idt="development" class="trail">Developing Applications ▷</li><li idt="http" class="trail">HTTP client ▷</li><li idt="termination" class="trail">HTTP request termination</li></ul>
            
        </div>
        
        <!-- find box appears in top-left of display - normally hidden -->
        
        <div class="found">
            
            <p class="foundClosed"></p>
            
            <p class="foundNext"></p>
            
            <p class="foundPrev"></p>
            
            <p id="findstatus" class="foundCount">searching...</p>
            
        </div>
        
        <div id="foundPaths"></div>
        
        <div id="nav" class="unselectable">
            
            
            <!-- logo and search -->
            
            <div id="logo">
                
                <p class="logoBox"><img src="Saxon-JS%20HTTP%20request%20termination_files/logo_crop-mid-blue-background.gif" alt="saxonica.com" width="120" height="24"></p>
                
                
                <p class="arrowNone"></p>
                
                <p class="search"></p>
                <input id="search" style="font-family:inherit;font-size:12px;float:right;padding:2px;margin-top:4px;width:110px;border:none;">
                    
            </div>
            
            
            <!-- tree-view -->
            
            <ul id="list"><li class="open" id="about"><span class="item">About Saxon-JS</span><ul><li id="saxonce" class="empty"><span class="item">Comparison with Saxon-CE</span></li></ul></li><li class="open" id="changes"><span class="item">Change History</span></li><li class="open" id="starting"><span class="item">Getting started</span><ul><li id="installing" class="empty"><span class="item">Installing the Software</span></li><li id="export" class="empty"><span class="item">Exporting for JS</span></li><li id="running" class="empty"><span class="item">Running Saxon-JS</span></li></ul></li><li class="open" id="development"><span class="item">Developing Applications</span><ul><li id="namespaces" class="empty"><span class="item">Namespaces</span></li><li id="result-documents" class="empty"><span class="item">Result documents</span></li><li id="source-documents" class="empty"><span class="item">Source documents</span></li><li id="events" class="empty"><span class="item">Handling user input events</span></li><li id="system-events" class="empty"><span class="item">Handling client system events</span></li><li id="animation" class="empty"><span class="item">Animation</span></li><li id="http" class="open"><span class="item">HTTP client</span><ul><li id="termination" class="empty"><span class="hot">HTTP request termination</span></li></ul></li><li id="global" class="empty"><span class="item">Using global JavaScript functions</span></li><li id="properties" class="empty"><span class="item">Properties of JavaScript objects</span></li><li id="saxonce" class="empty"><span class="item">Migration from Saxon-CE</span></li></ul></li><li class="closed" id="ixsl-extension"><span class="item">Saxon Interactive Extensions</span></li><li class="open" id="api"><span class="item">JavaScript API</span><ul><li id="transform" class="closed"><span class="item">SaxonJS.transform</span></li><li id="getProcessorInfo" class="empty"><span class="item">SaxonJS.getProcessorInfo</span></li><li id="setLogLevel" class="empty"><span class="item">SaxonJS.setLogLevel</span></li><li id="xpathEvaluate" class="empty"><span class="item">SaxonJS.XPath.evaluate</span></li></ul></li><li class="closed" id="conformance"><span class="item">Standards Conformance</span></li><li class="closed" id="samples"><span class="item">Sample Saxon-JS Applications</span></li><li class="closed" id="conditions"><span class="item">Licensing</span></li></ul>
            
        </div>
        
        <!-- main page -->
        
        <div id="main" style="float:left">
         <h1>HTTP request termination</h1>
         
         <aside>Requires Saxon-JS 1.1.0 and Saxon-EE 9.8.0.10 or later.</aside>
         
         <p>From Saxon-JS 1.1.0, it is possible to specify a timeout for an asynchronous HTTP
            request, or abort such a request if it takes too long. Furthermore, the code has been
            improved to handle cases such as these where no response is returned.</p>
         
         <p>If an HTTP request (specified by an <code>http-request</code> attribute on an
            <span class="link bodylink code" data-href="/ixsl-extension/instructions/schedule-action">ixsl:schedule-action</span>
            instruction) is terminated because of an error (e.g. a denied cross-domain request
            error), timeout or abort event, then the scheduled template call is invoked (i.e. this
            is treated as an alternative to receiving a response from the HTTP request). In this
            case the context item (which is usually a map representation of the HTTP response) is an
            XPath map containing information about the request termination, with the following
            entries:</p>
         
         <table>
            <thead>
               <tr>
                  <th>Key</th>
                  <th>Value</th>
                  <th>Meaning</th>
               </tr>
            </thead>
            <tbody>
               <tr>
                  <td><code>status</code></td>
                  <td><code>xs:integer</code></td>
                  <td><p>HTTP status code 0.</p></td>
               </tr>
               <tr>
                  <td><code>message</code></td>
                  <td><code>xs:string</code></td>
                  <td><p>Saxon-JS termination message.</p></td>
               </tr>
               <tr>
                  <td><code>error</code></td>
                  <td><code>xs:string</code></td>
                  <td><p>Saxon-JS internal error code.</p></td>
               </tr>
               <tr>
                  <td><code>type</code></td>
                  <td><code>xs:string</code></td>
                  <td><p>The type of the ProgressEvent which terminated the request
                     (error|timeout|abort).</p></td>
               </tr>
            </tbody>
            
         </table>
         
         <h2>Timeout for an HTTP request</h2>
         <p>For an HTTP request specified using the <code>http-request</code> attribute on
            <code>ixsl:schedule-action</code>, a timeout can be specified using either the
            <code>wait</code> attribute, or using an entry with key 'timeout' in the map specifying
            the request parameters. An entry in the request map takes precedence.</p>
         
         <p>The following example shows an <code>ixsl:schedule-action</code> instruction call using
            both <code>http-request</code> and <code>wait</code> attributes. If an HTTP response is
            not returned for the specified request within 2 seconds, the request is terminated by
            the timeout. The called template handles this request termination outcome (using the
            <code>xsl:if</code> with condition <code>?status = 0</code>) as well as the usual
            HTTP response (when <code>?body</code> is nonempty), producing alternative HTML
            fragments sent to the element with id="target".</p>
         <p><samp>&lt;xsl:template name="send-request"&gt;
   &lt;xsl:variable name="request" select="
   map{
      'method': 'POST',
      'href': 'http://localhost:19757/mywebapp/receiveXML',
      'body': $body, 
      'media-type': 'application/xml'
      } "/&gt;
   &lt;ixsl:schedule-action http-request="$request" wait="2000"&gt;
      &lt;xsl:call-template name="handle-response"/&gt;
   &lt;/ixsl:schedule-action&gt;
&lt;/xsl:template&gt;

&lt;xsl:template name="handle-response"&gt;
   &lt;xsl:context-item as="map(*)" use="required"/&gt;
   &lt;xsl:for-each select="?body"&gt;
      &lt;xsl:result-document href="#target" method="ixsl:replace-content"&gt;
         &lt;p&gt;Response from request:&lt;/p&gt;
         &lt;xsl:sequence select="."/&gt;
      &lt;/xsl:result-document&gt;
   &lt;/xsl:for-each&gt;
   &lt;xsl:if test="?status = 0"&gt;
      &lt;xsl:result-document href="#target" method="ixsl:replace-content"&gt;
         &lt;p&gt;Request terminated due to: &lt;xsl:value-of select="?type"/&gt;&lt;/p&gt;
      &lt;/xsl:result-document&gt;
   &lt;/xsl:if&gt;
&lt;/xsl:template&gt;</samp></p>
         
         
         <h2>Aborting an HTTP request</h2>
         
         <p>The following example shows XSLT code to allow users to abort an asynchronous HTTP
            request specified using <code>ixsl:schedule-action/@http-request</code> if it takes too
            long. The HTTP request is made by clicking the 'test' button, and the XMLHttpRequest
            (XHR) object returned from the <code>ixsl:schedule-action</code> call is stored as a
            property on the 'abort' button. Subsequently, if this 'abort' button is clicked, the
            request is terminated by calling the <code>abort()</code> method on the XHR object. The
            scheduled action (specified in the call-template instruction) is then invoked. This
            template handles response or termination outcomes. The 'test' and 'abort' buttons are
            hidden and revealed in the HTML page as appropriate, by setting the display style
            property.</p>
         
         <samp>&lt;xsl:template match="button[@id eq 'test']" mode="ixsl:onclick"&gt;
   &lt;ixsl:set-style name="display" select="'none'" object="."/&gt;
   &lt;xsl:result-document href="#target" method="ixsl:replace-content"/&gt;
   &lt;xsl:variable name="request" as="item()*"&gt;
      &lt;ixsl:schedule-action http-request="$requestParams"&gt;
         &lt;xsl:call-template name="action"/&gt;
      &lt;/ixsl:schedule-action&gt;
   &lt;/xsl:variable&gt;
   &lt;ixsl:set-property name="_saxonRequest" select="$request"
      object="ixsl:page()//button[@id='abort']"/&gt;
   &lt;ixsl:set-style name="display" select="'inline'" 
      object="ixsl:page()//button[@id='abort']"/&gt;
&lt;/xsl:template&gt;

&lt;xsl:template match="button[@id eq 'abort']" mode="ixsl:onclick"&gt;
   &lt;ixsl:set-style name="display" select="'none'" object="."/&gt;
   &lt;xsl:variable name="request" select="ixsl:get(., '_saxonRequest')"/&gt;
   &lt;xsl:sequence select="ixsl:call($request, 'abort', [])"/&gt;
&lt;/xsl:template&gt;

&lt;xsl:template name="action"&gt;
   &lt;xsl:context-item as="map(*)" use="required"/&gt;
   &lt;xsl:for-each select="?body"&gt;
      &lt;xsl:result-document href="#target" method="ixsl:replace-content"&gt;
         &lt;p&gt;Response from request:&lt;/p&gt;
         &lt;xsl:sequence select="."/&gt;
      &lt;/xsl:result-document&gt;
   &lt;/xsl:for-each&gt;
   &lt;xsl:if test="?status = 0"&gt;
      &lt;xsl:result-document href="#target" method="ixsl:append-content"&gt;
         &lt;p&gt;Request terminated due to: &lt;xsl:value-of select="?type"/&gt;&lt;/p&gt;
         &lt;p&gt;&lt;xsl:value-of select="?message"/&gt;&lt;/p&gt;
      &lt;/xsl:result-document&gt;
   &lt;/xsl:if&gt;
   &lt;ixsl:set-style name="display" select="'inline'" 
      object="ixsl:page()//button[@id='test']"/&gt;
&lt;/xsl:template&gt;</samp>
      </div>
        
        <!-- footnote anchored to bottom of display -->
        
        <div id="footer">
            
            <div id="info" class="footnote">
                
                <p>Saxon-JS Documentation</p>
                
            </div>
            
            <div>
                
                <p class="arrowRight"></p>
                
                <p class="arrowLeft"></p> 
                
            </div>
            
        </div>
        
        
    </div>
      

   


</body></html>