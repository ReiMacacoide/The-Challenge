<!DOCTYPE html>
<html><head>
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <title>Saxon-JS Type Conversion between JavaScript and XDM</title>
        <meta name="robots" content="noindex, nofollow">
        <meta name="viewport" content="width=768, minimum-scale=1.0, maximum-scale=1.0">
        <script type="text/javascript" src="Saxon-JS%20Type%20Conversion%20between%20JavaScript%20and%20XDM_files/jstree.js"></script>
        <script src="Saxon-JS%20Type%20Conversion%20between%20JavaScript%20and%20XDM_files/SaxonJS.js"></script>
        <script>
      window.onload = function() {
        SaxonJS.transform({
           stylesheetLocation: "xsl/jstree.sef.xml",
           initialTemplate: "main"
           });
      }     
        </script>
        <link href="Saxon-JS%20Type%20Conversion%20between%20JavaScript%20and%20XDM_files/jstree.css" rel="stylesheet" type="text/css">
            
    </head>

<body>

    <div id="wrap">
        
        <div id="header" class="unselectable">
            
            <!-- bread-crumb trail -->
            
            <ul class="trail" id="trail"><li id="trail1"><a href="http://saxonica.com/">Saxonica ▷</a></li><li id="trail2"><a href="http://www.saxonica.com/saxon-js/index.xml">Saxon-JS ▷</a></li><li idt="ixsl-extension" class="trail">Saxon Interactive Extensions ▷</li><li idt="conversions" class="trail">JS/XDM Type Conversion</li></ul>
            
        </div>
        
        <!-- find box appears in top-left of display - normally hidden -->
        
        <div class="found">
            
            <p class="foundClosed"></p>
            
            <p class="foundNext"></p>
            
            <p class="foundPrev"></p>
            
            <p id="findstatus" class="foundCount">searching...</p>
            
        </div>
        
        <div id="foundPaths"></div>
        
        <div id="nav" class="unselectable">
            
            
            <!-- logo and search -->
            
            <div id="logo">
                
                <p class="logoBox"><img src="Saxon-JS%20Type%20Conversion%20between%20JavaScript%20and%20XDM_files/logo_crop-mid-blue-background.gif" alt="saxonica.com" width="120" height="24"></p>
                
                
                <p class="arrowNone"></p>
                
                <p class="search"></p>
                <input id="search" style="font-family:inherit;font-size:12px;float:right;padding:2px;margin-top:4px;width:110px;border:none;">
                    
            </div>
            
            
            <!-- tree-view -->
            
            <ul id="list"><li class="open" id="about"><span class="item">About Saxon-JS</span><ul><li id="saxonce" class="empty"><span class="item">Comparison with Saxon-CE</span></li></ul></li><li class="open" id="changes"><span class="item">Change History</span></li><li class="open" id="starting"><span class="item">Getting started</span><ul><li id="installing" class="empty"><span class="item">Installing the Software</span></li><li id="export" class="empty"><span class="item">Exporting for JS</span></li><li id="running" class="empty"><span class="item">Running Saxon-JS</span></li></ul></li><li class="open" id="development"><span class="item">Developing Applications</span><ul><li id="namespaces" class="empty"><span class="item">Namespaces</span></li><li id="result-documents" class="empty"><span class="item">Result documents</span></li><li id="source-documents" class="empty"><span class="item">Source documents</span></li><li id="events" class="empty"><span class="item">Handling user input events</span></li><li id="system-events" class="empty"><span class="item">Handling client system events</span></li><li id="animation" class="empty"><span class="item">Animation</span></li><li id="http" class="open"><span class="item">HTTP client</span><ul><li id="termination" class="empty"><span class="item">HTTP request termination</span></li></ul></li><li id="global" class="empty"><span class="item">Using global JavaScript functions</span></li><li id="properties" class="empty"><span class="item">Properties of JavaScript objects</span></li><li id="saxonce" class="empty"><span class="item">Migration from Saxon-CE</span></li></ul></li><li class="open" id="ixsl-extension"><span class="item">Saxon Interactive Extensions</span><ul><li id="functions" class="open"><span class="item">Extension functions</span><ul><li id="apply" class="empty"><span class="item">ixsl:apply</span></li><li id="call" class="empty"><span class="item">ixsl:call</span></li><li id="eval" class="empty"><span class="item">ixsl:eval</span></li><li id="event" class="empty"><span class="item">ixsl:event</span></li><li id="get" class="empty"><span class="item">ixsl:get</span></li><li id="location" class="empty"><span class="item">ixsl:location</span></li><li id="page" class="empty"><span class="item">ixsl:page</span></li><li id="query-params" class="empty"><span class="item">ixsl:query-params</span></li><li id="source" class="empty"><span class="item">ixsl:source</span></li><li id="style" class="empty"><span class="item">ixsl:style</span></li><li id="window" class="empty"><span class="item">ixsl:window</span></li></ul></li><li id="instructions" class="open"><span class="item">Extension instructions</span><ul><li id="remove-attribute" class="empty"><span class="item">ixsl:remove-attribute</span></li><li id="schedule-action" class="empty"><span class="item">ixsl:schedule-action</span></li><li id="set-attribute" class="empty"><span class="item">ixsl:set‑attribute</span></li><li id="set-property" class="empty"><span class="item">ixsl:set-property</span></li><li id="set-style" class="empty"><span class="item">ixsl:set-style</span></li></ul></li><li id="conversions" class="empty"><span class="hot">JS/XDM Type Conversion</span></li></ul></li><li class="open" id="api"><span class="item">JavaScript API</span><ul><li id="transform" class="closed"><span class="item">SaxonJS.transform</span></li><li id="getProcessorInfo" class="empty"><span class="item">SaxonJS.getProcessorInfo</span></li><li id="setLogLevel" class="empty"><span class="item">SaxonJS.setLogLevel</span></li><li id="xpathEvaluate" class="empty"><span class="item">SaxonJS.XPath.evaluate</span></li></ul></li><li class="closed" id="conformance"><span class="item">Standards Conformance</span></li><li class="closed" id="samples"><span class="item">Sample Saxon-JS Applications</span></li><li class="closed" id="conditions"><span class="item">Licensing</span></li></ul>
            
        </div>
        
        <!-- main page -->
        
        <div id="main" style="float:left">
      <h1>Type Conversion between JavaScript and XDM</h1>

      <p>This section describes type conversions from JavaScript values to XDM values, and from XDM
         values to JavaScript values. (XDM is the XPath and XSLT Data Model.)</p>


      <h2>XDM to JavaScript Conversion</h2>

      <p>These conversions are applied to values supplied as arguments to extension functions such
         as <code>ixsl:call()</code>.</p>
      <p>The conversion of results from calls to <span class="link bodylink code" data-href="/api/xpathEvaluate">SaxonJS.XPath.evaluate</span> is slightly different, for details see
         that section.</p>

      <table>
         <thead>
            <tr>
               <th>XDM Type</th>
               <th>JavaScript Type</th>
            </tr>
         </thead>
         <tbody>
            <tr>
               <td>xs:string, xs:anyURI, xs:untypedAtomic, xs:duration, xs:hexBinary,
                  xs:base64Binary</td>
               <td>String</td>
            </tr>
            <tr>
               <td>xs:double, xs:float, xs:decimal, xs:integer</td>
               <td>Number</td>
            </tr>
            <tr>
               <td>xs:boolean</td>
               <td>Boolean</td>
            </tr>
            <tr>
               <td>xs:dateTime, xs:date, xs:time, xs:gYear, xs:gYearMonth, xs:gMonth, xs:gMonthDay,
                  xs:gDay</td>
               <td>String <!-- TODO: Date? --></td>
            </tr>
            <tr>
               <td>xs:QName</td>
               <td>String in <code>Q{uri}local</code> format</td>
            </tr>
            <tr>
               <td>node()</td>
               <td>XML or HTML DOM Node (except for namespace nodes, where the Saxon-JS
                  representation is handed over unchanged). Note that an XDM
                  document-node() may get converted to a DocumentFragment rather than a
               Document.</td>
            </tr>
            <tr>
               <td>array(*)</td>
               <td>Array, whose items are converted by applying these rules recursively</td>
            </tr>
            <tr>
               <td>empty sequence</td>
               <td>Null</td>
            </tr>
            <tr>
               <td>sequence of length &gt; 1</td>
               <td>Array, whose items are converted by applying these rules recursively</td>
            </tr>
            <tr>
               <td>map(*)</td>
               <td><p>Wrapped XDM map object (except for results from calls to <span class="link bodylink code" data-href="/api/xpathEvaluate">SaxonJS.XPath.evaluate</span>, for details see that section).</p> 
                  </td>
            </tr>
            <tr>
               <td>Wrapped external object (JSValue)</td><!-- JSValue -->
               <td>The object with its wrapper removed</td>
            </tr>
         </tbody>
      </table>

      <p>Note that passing an XDM sequence to a JavaScript function is awkward, because the
         JavaScript code may receive null, a single value, or an array, depending on the length of
         the sequence. It is more convenient to pass an XPath array, which will always be received as a
         JavaScript array. Any XPath value <code>$V</code> can be passed as an array simply by
         enclosing it in square brackets, for example <code>js:process([$V])</code>.</p>

      <h2>JavaScript to XDM Conversion</h2>

      <p>These conversions are applied to values returned from extension functions (including
            <code>ixsl:call</code> and <code>ixsl:get</code>), and to values supplied for template
         and function parameters using the options of <span class="link bodylink code" data-href="/api/transform">SaxonJS.transform</span>.</p>
      <p>These conversions are also applied to stylesheet parameters when they have no declared type,
         or the declared type is item(). For the conversions applied to stylesheet parameters which
         have a declared type, see <span class="link bodylink" data-href="/api/transform/parameters">Supplying
            stylesheet parameters</span> (these are different because there is a required XDM type that
         influences the conversion).</p>

      <table>
         <thead>
            <tr>
               <th>JavaScript Type</th>
               <th>XDM Type</th>
            </tr>
         </thead>
         <tbody>
            <tr>
               <td>Null, Undefined</td>
               <td>Empty sequence</td>
            </tr>
            <tr>
               <td>String</td>
               <td>xs:string</td>
            </tr>
            <tr>
               <td>Number</td>
               <td>xs:double</td>
            </tr>
            <tr>
               <td>Boolean</td>
               <td>xs:boolean</td>
            </tr>
            <tr>
               <td>Date</td>
               <td>xs:dateTime</td>
            </tr>
            <tr>
               <td>Node</td>
               <td>node()</td>
            </tr>
            <tr>
               <td>Array</td>
               <td>Sequence, whose items are obtained by converting the members of the array
                  recursively; except that any nested arrays become XPath array items (see below)</td>
            </tr>
            <tr>
               <td>Function</td>
               <td>Wrapped external object (JSValue)</td>
            </tr>
            <tr>
               <td>Wrapped XDM map</td><!-- XDMValue -->
               <td>The XDM map(*) with its wrapper removed</td>
            </tr>
            <tr>
               <td>(other) Object (including Window, Location)</td>
               <td>
                  <p>Either converted to a wrapped external object (JSValue), or to an XDM map(*).
                     The conversion depends on where the JavaScript object came from; see the
                     subsection "Conversion of 'other' JavaScript Objects" below for full details.</p>
               </td>
            </tr>
         </tbody>
      </table>
      <p>
         For example, the JavaScript array <code>['a','b','c']</code> is converted to the XDM sequence
         <code>('a','b','c')</code>; while the nested JavaScript array <code>[['a','b','c']]</code>
         is converted to the XPath array <code>['a','b','c']</code>. The nested JavaScript array
         <code>[['a','b','c'], [1,2,3,4], ['string', true, 42]]</code> is converted to an XDM sequence of
         arrays.</p>
      
      <h3>Conversion of 'other' JavaScript Objects</h3>
      
      <p>Note the special case for the conversion of 'other' JavaScript Objects, i.e. objects which
         are not a more specific type which is recognised: null, undefined, String,
         Number, Boolean, Date, Node, Array, or Function.</p>
      
      <p>JavaScript Objects look a bit like XDM maps, since they both have key-value pairs, but
         there is no lossless conversion from one to the other and back (one reason being that JS
         objects have inherited properties), so we can not simply align the two (as for JS Boolean
         and xs:boolean, etc.). To allow <code>map(*)</code> type stylesheet parameters to be
         supplied, sometimes (simple) JavaScript Objects should be converted fully to XDM maps (held
         internally as "HashTrie" objects); in other cases, JavaScript Objects should not be
         converted, and instead just wrapped as "JSValues" and left to be handled as external
         Objects.</p>
      
      <p>So there are two types of conversion used for such JavaScript Objects, which will be
         referred to as "Case 1" and "Case 2". The conversion which is used depends on where the
         JavaScript Object comes from, as specified in the table below:</p>
      
      <table class="objectConversion">
         <thead>
            <tr>
               <td class="col-case">Case</td>
               <td class="col-input">Object input</td>
               <td class="col-ouput">Converted output</td>
            </tr>
         </thead>
         <tbody>
            <tr>
               <td>Case 1</td>
               <td>
                  <ul>
                     <li>Stylesheet parameters with no declared type.</li>
                     <li>Values returned from IXSL and JS extension functions.</li>
                  </ul>
               </td>
               <td><!-- JSValue -->
                  <p>Wrapped external object (JSValue), which behaves a little like a "read-only"
                     XPath map. The properties of the object become key-value pairs within the map,
                     where the key is the property name (as a string), and the value is obtained by
                     applying the above JavaScript to XDM conversion rules recursively, using "Case
                     1" conversion for nested objects. Note that only the following "accessor" map
                     functions can be used: <code>map:get()</code>, <code>map:contains()</code>,
                     <code>map:find()</code>. But not <code>map:keys()</code>,
                     or other functions which edit a map. This allows the use of the shorthand
                     <code>$object?prop</code> for <code>ixsl:get($object, 'prop')</code> (see <span class="link bodylink" data-href="/development/properties">Properties of JavaScript
                        objects</span> for further details).</p>
               </td>
            </tr>
            <tr>
               <td>Case 2</td>
               <td>
                  <ul>
                     <li>Stylesheet parameters with declared type other than
                        <code>item()*</code>.</li>
                     <li>Function and template parameters supplied at run time (using the
                        <code>functionParams</code>, <code>templateParams</code>, and
                        <code>tunnelParams</code> options for <code>SaxonJS.transform()</code>) -
                        whether or not the parameters have declared types.</li>
                     <li>Values supplied to <span class="link bodylink code" data-href="/api/xpathEvaluate">SaxonJS.XPath.evaluate</span> (for the context item,
                        or the value of parameters supplied for the <code>params</code> option)</li>
                  </ul>
               </td>
               <td><!-- HashTrie -->
                  <p>XDM map(*), where the properties of the JavaScript object become
                     key-value pairs within the map, where the key is the property name (as a
                     string), and the value is obtained by applying the above JavaScript to XDM
                     conversion rules recursively, using "Case 2" conversion for nested objects.</p>
               </td>
            </tr>
         </tbody>
      </table>

   </div>
        
        <!-- footnote anchored to bottom of display -->
        
        <div id="footer">
            
            <div id="info" class="footnote">
                
                <p>Saxon-JS Documentation</p>
                
            </div>
            
            <div>
                
                <p class="arrowRight"></p>
                
                <p class="arrowLeft"></p> 
                
            </div>
            
        </div>
        
        
    </div>
      

   


</body></html>