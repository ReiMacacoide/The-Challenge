<!DOCTYPE html>
<html><head>
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <title>Saxon-JS SaxonJS.XPath.evaluate</title>
        <meta name="robots" content="noindex, nofollow">
        <meta name="viewport" content="width=768, minimum-scale=1.0, maximum-scale=1.0">
        <script type="text/javascript" src="Saxon-JS%20SaxonJS.XPath.evaluate_files/jstree.js"></script>
        <script src="Saxon-JS%20SaxonJS.XPath.evaluate_files/SaxonJS.js"></script>
        <script>
      window.onload = function() {
        SaxonJS.transform({
           stylesheetLocation: "xsl/jstree.sef.xml",
           initialTemplate: "main"
           });
      }     
        </script>
        <link href="Saxon-JS%20SaxonJS.XPath.evaluate_files/jstree.css" rel="stylesheet" type="text/css">
            
    </head>

<body>

    <div id="wrap">
        
        <div id="header" class="unselectable">
            
            <!-- bread-crumb trail -->
            
            <ul class="trail" id="trail"><li id="trail1"><a href="http://saxonica.com/">Saxonica ▷</a></li><li id="trail2"><a href="http://www.saxonica.com/saxon-js/index.xml">Saxon-JS ▷</a></li><li idt="api" class="trail">JavaScript API ▷</li><li idt="xpathEvaluate" class="trail">SaxonJS.XPath.evaluate</li></ul>
            
        </div>
        
        <!-- find box appears in top-left of display - normally hidden -->
        
        <div class="found">
            
            <p class="foundClosed"></p>
            
            <p class="foundNext"></p>
            
            <p class="foundPrev"></p>
            
            <p id="findstatus" class="foundCount">searching...</p>
            
        </div>
        
        <div id="foundPaths"></div>
        
        <div id="nav" class="unselectable">
            
            
            <!-- logo and search -->
            
            <div id="logo">
                
                <p class="logoBox"><img src="Saxon-JS%20SaxonJS.XPath.evaluate_files/logo_crop-mid-blue-background.gif" alt="saxonica.com" width="120" height="24"></p>
                
                
                <p class="arrowNone"></p>
                
                <p class="search"></p>
                <input id="search" style="font-family:inherit;font-size:12px;float:right;padding:2px;margin-top:4px;width:110px;border:none;">
                    
            </div>
            
            
            <!-- tree-view -->
            
            <ul id="list"><li class="closed" id="about"><span class="item">About Saxon-JS</span><ul><li id="saxonce" class="empty"><span class="item">Comparison with Saxon-CE</span></li></ul></li><li class="open" id="changes"><span class="item">Change History</span></li><li class="closed" id="starting"><span class="item">Getting started</span><ul><li id="installing" class="empty"><span class="item">Installing the Software</span></li><li id="export" class="empty"><span class="item">Exporting for JS</span></li><li id="running" class="empty"><span class="item">Running Saxon-JS</span></li></ul></li><li class="closed" id="development"><span class="item">Developing Applications</span><ul><li id="namespaces" class="empty"><span class="item">Namespaces</span></li><li id="result-documents" class="empty"><span class="item">Result documents</span></li><li id="source-documents" class="empty"><span class="item">Source documents</span></li><li id="events" class="empty"><span class="item">Handling user input events</span></li><li id="system-events" class="empty"><span class="item">Handling client system events</span></li><li id="animation" class="empty"><span class="item">Animation</span></li><li id="http" class="open"><span class="item">HTTP client</span><ul><li id="termination" class="empty"><span class="item">HTTP request termination</span></li></ul></li><li id="global" class="empty"><span class="item">Using global JavaScript functions</span></li><li id="properties" class="empty"><span class="item">Properties of JavaScript objects</span></li><li id="saxonce" class="empty"><span class="item">Migration from Saxon-CE</span></li></ul></li><li class="closed" id="ixsl-extension"><span class="item">Saxon Interactive Extensions</span><ul><li id="functions" class="open"><span class="item">Extension functions</span><ul><li id="apply" class="empty"><span class="item">ixsl:apply</span></li><li id="call" class="empty"><span class="item">ixsl:call</span></li><li id="eval" class="empty"><span class="item">ixsl:eval</span></li><li id="event" class="empty"><span class="item">ixsl:event</span></li><li id="get" class="empty"><span class="item">ixsl:get</span></li><li id="location" class="empty"><span class="item">ixsl:location</span></li><li id="page" class="empty"><span class="item">ixsl:page</span></li><li id="query-params" class="empty"><span class="item">ixsl:query-params</span></li><li id="source" class="empty"><span class="item">ixsl:source</span></li><li id="style" class="empty"><span class="item">ixsl:style</span></li><li id="window" class="empty"><span class="item">ixsl:window</span></li></ul></li><li id="instructions" class="open"><span class="item">Extension instructions</span><ul><li id="remove-attribute" class="empty"><span class="item">ixsl:remove-attribute</span></li><li id="schedule-action" class="empty"><span class="item">ixsl:schedule-action</span></li><li id="set-attribute" class="empty"><span class="item">ixsl:set‑attribute</span></li><li id="set-property" class="empty"><span class="item">ixsl:set-property</span></li><li id="set-style" class="empty"><span class="item">ixsl:set-style</span></li></ul></li><li id="conversions" class="empty"><span class="item">JS/XDM Type Conversion</span></li></ul></li><li class="open" id="api"><span class="item">JavaScript API</span><ul><li id="transform" class="open"><span class="item">SaxonJS.transform</span><ul><li id="parameters" class="empty"><span class="item">Supplying stylesheet parameters</span></li></ul></li><li id="getProcessorInfo" class="empty"><span class="item">SaxonJS.getProcessorInfo</span></li><li id="setLogLevel" class="empty"><span class="item">SaxonJS.setLogLevel</span></li><li id="xpathEvaluate" class="empty"><span class="hot">SaxonJS.XPath.evaluate</span></li></ul></li><li class="closed" id="conformance"><span class="item">Standards Conformance</span></li><li class="closed" id="samples"><span class="item">Sample Saxon-JS Applications</span></li><li class="closed" id="conditions"><span class="item">Licensing</span></li></ul>
            
        </div>
        
        <!-- main page -->
        
        <div id="main" style="float:left">
        <h1>SaxonJS.XPath.evaluate</h1>

        <p>
            <b>
                <code>SaxonJS.XPath.evaluate(xpath, contextItem?, options?) </code>
            </b>
        </p>
        <p>This function evaluates an XPath 3.1 expression with JavaScript arguments and results. Its
            use <em>does not</em> require a compiled XSLT stylesheet (SEF) to be loaded via the
                <code>transform()</code> call. For dynamic evaluation within an XSLT transform, the
                <code>xsl:evaluate</code> instruction is both supported and suggested. </p>
        <p>The <code>xpath</code> argument is a String value of the XPath expression to be
            evaluated.</p>
        <p>The <code>contextItem</code> argument is used as the context item at the start of the
            evaluation of the expression. It will be converted from a JavaScript object to an XDM
            value according to the JavaScript to XDM conversion as described in <span class="link bodylink" data-href="/ixsl-extension/conversions">JS/XDM Type Conversion</span> (using "Case 2"
            conversion for JavaScript objects). In the absence of this argument, any reference to
            the invocation context item in the XPath expression will throw an error. If a JavaScript
            <code>Array</code> is supplied as the context item, it is assumed to represent an XDM
            sequence, according to the JavaScript to XDM convention. If that array is empty, the
            context item is absent. If that array has more than one member, a cardinality error is
            thrown. If you wish the context item to be considered of <code>array(*)</code> type,
            please see the discussion on 'Reusing XPath generated results' below.</p>

        <p>The <code>options</code> argument is a JavaScript literal object supplying the values for
            the static and dynamic evaluation of the expression. In the absence of this argument
            default option values are used. The options implemented for this release are defined in
            the following table. (Further options may be implemented in due course.)</p>
        <table>
            <thead>
                <tr>
                    <th>Key</th>
                    <th>Value</th>
                    <th>Meaning</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>
                        <code>params</code>
                    </td>
                    <td>
                        <code>object</code>
                    </td>
                    <td>
                        <p>A JavaScript object containing the values of parameters whose values can
                            be referred to in the expression. The key is the name of the parameter
                            either as a simple local name, or in the form
                            '<code>Q{uri}local</code>'. The corresponding value is a JavaScript
                            value which is converted to an XDM value according to the JavaScript to
                            XDM conversion as described in <span class="link bodylink" data-href="/ixsl-extension/conversions">JS/XDM Type Conversion</span> (using
                            "Case 2" conversion for JavaScript objects). The default is no
                            referable parameters.</p>
                    </td>
                </tr>
                <tr>
                    <td>
                        <code>staticBaseURI</code>
                    </td>
                    <td>
                        <code>String</code>
                    </td>
                    <td>
                        <p>the static base uri for situations which require its value. The default
                            is the HTML page location, i.e. the value of
                                <code>window.location.href</code>.</p>
                    </td>
                </tr>
                <tr>
                    <td>
                        <code>namespaceContext</code>
                    </td>
                    <td>
                        <code>object</code>
                    </td>
                    <td>
                        <p>A JavaScript object containing the bindings of prefixes to namespaces to
                            be used in the XPath expression. The key is the prefix; the
                            corresponding value as a String, is the respective URI. (Note this is a
                            JavaScript <b>property map</b>, not a node-with-namespace-bindings. We
                            will eventually write an access function that returns a map of active
                            namespace bindings from a DOM (XML) node.) The default is no prefixes
                            being bound.</p>
                    </td>
                </tr>
                <tr>
                    <td>
                        <code>xpathDefaultNamespace</code>
                    </td>
                    <td>
                        <code>String</code>
                    </td>
                    <td>
                        <p>the default namespace for unprefixed QNames in the expression. Default is
                            "".</p>
                    </td>
                </tr>
                <tr>
                    <td>
                        <code>defaultDecimalFormat</code>
                    </td>
                    <td>
                        <code>object</code>
                    </td>
                    <td>
                        <p>A JavaScript object containing the (alterations to the) default or
                            unnamed decimal format for use by <code>format-number()</code> calls
                            within the XPath expression. The keys of the object are the selected
                            components as described for <code>xsl:decimal-format</code>; the
                            corresponding value is the required component value. In the absence of
                            this option, default number formatting is performed for the unnamed
                            (default) decimal format.<br> For example, with
                            <pre>defaultDecimalFormat: {"decimal-separator":",",
                     "grouping-separator":"."}
...
format-number(12345.6, '#.###,00') → "12.345,60"</pre>
                        </p>
                    </td>
                </tr>
                <tr>
                    <td>
                        <code>namedDecimalFormats</code>
                    </td>
                    <td>
                        <code>object</code>
                    </td>
                    <td>
                        <p>A JavaScript object containing named decimal formats for use in
                                <code>format-number()</code> calls within the XPath expression. The
                            key is the name of the format; the corresponding value is a map for that
                            named format, in the same form as described for
                                <code>defaultDecimalFormat</code> above.<br> For example, with
                            <pre>namedDecimalFormats: {"alternate":{"infinity":"out-of-range"}}
...
format-number(1e0 div 0, '#','alternate') → "out-of-range"</pre></p>
                    </td>
                </tr>
                <tr>
                    <td>
                        <code>resultForm</code>
                    </td>
                    <td>
                        <code>String</code>
                    </td>
                    <td>
                        <p>The form in which the expression result should be emitted. Items in the
                            result are converted from XDM to JavaScript according to the JavaScript
                            to XDM conversion as described in <span class="link bodylink" data-href="/ixsl-extension/conversions">JS/XDM Type Conversion</span>,
                            except that XDM maps are converted to JavaScript object literals as
                            described below. These results are returned as a sequence according to
                            the following values of this option:</p>
                        <table>
                            <thead>
                                <tr>
                                    <th>Value</th>
                                    <th>Effect</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>
                                        <code>default</code>
                                    </td>
                                    <td>
                                        <p>The default behaviour: an empty sequence is returned as
                                                <code>null</code>, a singleton as its JavaScript
                                            conversion, and sequences longer than one item as an
                                            array.</p>
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <code>array</code>
                                    </td>
                                    <td>
                                        <p>The result will be always be returned as an array, even
                                            if it is a singleton or an empty sequence, in which case
                                            the array result will have one or zero members
                                            respectively.</p>
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <code>iterator</code>
                                    </td>
                                    <td>
                                        <p>The result will be always be returned as an iterator over
                                            the converted result sequence rather than an array,
                                            singleton or null. The iterator will be an instance of
                                                <code>SaxonJS.U.AnyIterator</code> and responds to
                                            the usual <code>next()</code> behaviour, converting from
                                            XDM to JavaScript only as each member is requested. The
                                            iterator may operate <em>lazily</em> across members of
                                            the sequence, unlike in the other cases, where the
                                            complete sequence is resolved and written into an array.
                                            In cases where the JavaScript using these results is
                                            modifying sections of the tree from which results are
                                            being computed, this may cause complications.</p>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </td>
                </tr>

            </tbody>
        </table>
        <p>Currently the following static properties from the equivalent <code>xsl:evaluate</code>
            instruction are not supported:</p>
        <ul>
            <li>Statically known collations. The default collation is Unicode Codepoint
                collation.</li>
        </ul>
        <p>The XDM result is converted to JavaScript according to the XDM to JavaScript conversion
            as described in <span class="link bodylink" data-href="/ixsl-extension/conversions">JS/XDM Type
                Conversion</span>, except that XDM maps are converted to JavaScript object literals,
            and 'wrapped' according to the effective <code>resultForm</code> option described above.
            In the case of an error during evaluation of the expression (in either static or dynamic
            phase), an <code>XError</code> is thrown. The <code>code</code> property of this object
            yields the (string) error code. The <code>message</code> property provides a diagnostic
            error string.</p>
        <p>For results from <code>SaxonJS.XPath.evaluate</code> only, XDM maps are "flattened" to
            produce a JavaScript object literal. The keys become property names (an atomic value is
            first cast to an <code>xs:string</code>, and then converted to a JavaScript String), and
            the value is obtained by applying the XDM to JavaScript conversion rules recursively, also
            converting nested XDM maps to JavaScript object literals.</p>

        <h2>Current limitations</h2>
        <p>The following features are not supported within the current version of
                <code>XPath.evaluate()</code>:</p>
        <ul>
            <li>Embedded comments in the XPath expression</li>
            <li>Any higher order functions including function name references and inlined function
                bodies</li>
            <li>Any of the <span class="link bodylink" data-href="/conformance">other general restrictions on
                    Saxon-JS</span>, such as unsupported functions (e.g. <code>fn:sort()</code>)</li>
        </ul>
        <h2>Reusing XPath generated results</h2>
        <p>If you intend to take results from one XPath evaluation and, using JavaScript variable
            bindings, reuse these as arguments (as parameters or context item) in another
            evaluation, you should be aware of issues arising from the dual representation of
            XDM sequences and arrays as JavaScript <code>Array</code>,
            as described in <span class="link bodylink" data-href="/ixsl-extension/conversions">Type Conversion
                between JavaScript and XDM</span>. If we execute the following:</p>
        <samp>var exp = 'map{"cities": [ map{"name":"Milano", "pop":5, "country":"Italia"}, 
    map{"name":"London", "country":"GB"} ] }';
var contextItem = SaxonJS.XPath.evaluate(exp);</samp>
        <p>then <code>contextItem</code> is an <code>Object</code> with one property
                <code>cities</code>, whose value is an <code>Array</code> with two
                <code>Object</code> members. On reusing this as the context item for another
            expression:</p>
        <samp>SaxonJS.XPath.evaluate('?cities', contextItem);</samp>
        <p>the conversion of <code>contextItem</code> into XDM assumes the <code>Array</code> object
            corresponding to <code>contextItem.cities</code> is an XDM sequence, not an
            XDM array, so an access assuming an array type as originally written
            (e.g. <code>?cities?*?country</code>) will produce unintended results.</p>
        <p>If you intend an <code>array(*)</code> value to be emitted from an evaluation to be reused
            subsequently, then the array must be 'wrapped' in a further array, to account for the
            sequence representation that is removed during JavaScript to XDM conversion. For our
            example:</p>
        <samp>var exp = 'map{"cities": [[ map{"name":"Milano", "pop":5, "country":"Italia"}, 
    map{"name":"London", "country":"GB"} ]] }';
var contextItem = SaxonJS.XPath.evaluate(exp);
SaxonJS.XPath.evaluate('serialize(?cities?*?country)', contextItem);</samp>
        <p>returns <code>('Italia', 'GB')</code>.</p>
        <p>(Our thanks to Martin Honnen for discovering this issue.)</p>
    </div>
        
        <!-- footnote anchored to bottom of display -->
        
        <div id="footer">
            
            <div id="info" class="footnote">
                
                <p>Saxon-JS Documentation</p>
                
            </div>
            
            <div>
                
                <p class="arrowRight"></p>
                
                <p class="arrowLeft"></p> 
                
            </div>
            
        </div>
        
        
    </div>
      

   


</body></html>